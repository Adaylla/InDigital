{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}InDigital{% endblock title %}</title>

    <link rel="icon" type="image/png" href="{% static 'assets/favicon.ico' %}"/>
    <link href="{% static 'css/styles.css' %}" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/css/adminlte.min.css">

    {% block extra_css %}{% endblock extra_css %}
</head>

<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">

    {% if request.resolver_match.url_name != 'account_login' and request.resolver_match.url_name != 'suap_login' %}

        <div class="mobile-overlay" id="mobileOverlay"></div>

        <!-- Sidebar -->
        {% if user.is_authenticated %}
            <aside class="custom-sidebar" id="customSidebar">
                <a href="{% url 'index' %}" class="custom-brand"><span>InDigital</span></a>
                <div class="custom-menu">
                    <!-- Menu items -->
                    {% if user.perfil == 'administrador' or user.is_superuser %}
                        <a href="{% url 'admin_dashboard' %}" class="custom-menu-item"><i class="fas fa-home"></i> Início</a>
                        <div class="custom-menu-section">ADMINISTRAÇÃO</div>
                        <a href="{% url 'reservas_pendentes' %}" class="custom-menu-item"><i class="fas fa-check-circle"></i> Aprovar Reservas</a>
                        <a href="{% url 'reservas' %}" class="custom-menu-item"><i class="fas fa-calendar-check"></i> Gerenciar Reservas</a>
                        <a href="{% url 'listar_disponibilidades' %}" class="custom-menu-item"><i class="fas fa-clock"></i> Gerenciar Disponibilidades</a>
                        <a href="{% url 'listar_laboratorios' %}" class="custom-menu-item"><i class="fas fa-laptop"></i> Gerenciar Laboratórios</a>
                        <a href="{% url 'listar_usuarios' %}" class="custom-menu-item"><i class="fas fa-user"></i> Gerenciar Usuários</a>
                        <a href="{% url 'listar_monitores' %}" class="custom-menu-item"><i class="fas fa-users"></i> Gerenciar Monitores</a>
                        <a href="{% url 'fila_espera' %}" class="custom-menu-item"><i class="fas fa-hourglass-half"></i> Gerenciar Fila de Espera</a>
                    {% elif user.perfil == 'monitor' %}
                        <a href="{% url 'monitor_dashboard' %}" class="custom-menu-item"><i class="fas fa-home"></i> Início</a>
                        <a href="{% url 'horarios' %}" class="custom-menu-item"><i class="fas fa-calendar-check"></i> Disponibilidades</a>
                        <a href="{% url 'minhas_reservas' %}" class="custom-menu-item"><i class="fas fa-users"></i> Minhas Reservas</a>
                        <a href="{% url 'historico_reservas' %}" class="custom-menu-item"><i class="fas fa-history"></i> Histórico de Reservas</a>
                        <a href="{% url 'minha_fila_espera' %}" class="custom-menu-item"><i class="fas fa-hourglass-half"></i> Fila de Espera</a>
                        <div class="custom-menu-section">MONITORAÇÃO</div>
                        <a href="{% url 'listar_disponibilidades_monitor' %}" class="custom-menu-item"><i class="fas fa-clipboard-check"></i> Registrar Frequências</a>
                    {% else %}
                        <a href="{% url 'index' %}" class="custom-menu-item"><i class="fas fa-home"></i> Início</a>
                        <a href="{% url 'horarios' %}" class="custom-menu-item"><i class="fas fa-calendar-check"></i> Disponibilidades</a>
                        <a href="{% url 'minhas_reservas' %}" class="custom-menu-item"><i class="fas fa-users"></i> Minhas Reservas</a>
                        <a href="{% url 'historico_reservas' %}" class="custom-menu-item"><i class="fas fa-history"></i> Histórico de Reservas</a>
                        <a href="{% url 'minha_fila_espera' %}" class="custom-menu-item"><i class="fas fa-hourglass-half"></i> Fila de Espera</a>
                    {% endif %}

                    <div class="custom-menu-section">USUÁRIO</div>
                    <a href="{% url 'perfil' %}" class="custom-menu-item"><i class="fas fa-user"></i> Perfil</a>
                    <form method="post" action="{% url 'account_logout' %}" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="custom-menu-item" style="background:none; border:none; width:100%; text-align:left; color:inherit;">
                            <i class="fas fa-sign-out-alt"></i> Sair
                        </button>
                    </form>
                </div>
            </aside>
        {% endif %}

        
        <header class="custom-header" id="customHeader">
            <div class="container-fluid d-flex justify-content-between align-items-center">
                <button class="btn btn-sm btn-outline-light" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <span class="d-none d-md-inline text-white">Olá, {{ request.user.first_name }}!</span>
            </div>
        </header>

    {% endif %}

    
    <div class="content-wrapper" id="customContent">
        {% if messages %}
            <div class="container mt-3">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <main class="content">
            <div class="container-fluid pb-4">
                {% block content %}{% endblock content %}
            </div>
        </main>
    </div>

    {% if not request.resolver_match.url_name == 'account_login' and not request.resolver_match.url_name == 'suap_login' %}
    <footer class="main-footer text-center py-3">
        <strong>Copyright © InDigital {% now 'Y' %}</strong>
    </footer>
    {% endif %}

</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/js/adminlte.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const menuToggle = document.getElementById('menuToggle');
    const sidebar = document.getElementById('customSidebar');
    const content = document.getElementById('customContent');
    const header = document.getElementById('customHeader');
    const mobileOverlay = document.getElementById('mobileOverlay');

    menuToggle.addEventListener('click', function() {
        if(window.innerWidth <= 768){
            sidebar.classList.toggle('mobile-open');
            mobileOverlay.classList.toggle('active');
        } else {
            sidebar.classList.toggle('collapsed');
            content.classList.toggle('collapsed');
            header.classList.toggle('collapsed');
        }
    });

    mobileOverlay.addEventListener('click', function() {
        sidebar.classList.remove('mobile-open');
        mobileOverlay.classList.remove('active');
    });

    window.addEventListener('resize', function() {
        if(window.innerWidth > 768){
            sidebar.classList.remove('mobile-open');
            mobileOverlay.classList.remove('active');
        }
    });
});
</script>

{% block extra_js %}{% endblock extra_js %}
</body>
</html>
